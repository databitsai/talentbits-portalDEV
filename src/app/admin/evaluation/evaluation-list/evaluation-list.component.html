<div class="card p-p-4 with-table-responsive">

    <p-toolbar styleClass="p-mb-4">
        <ng-template pTemplate="left">
            <button pButton pRipple label="Nuevo" icon="pi pi-plus" class="p-button-success p-mr-2"
                (click)="openNewEvaluation()"></button>
        </ng-template>
    </p-toolbar>

    <p-table #dt [value]="items" [rows]="5" [paginator]="true" [globalFilterFields]="['description']"
        [(selection)]="selectedItems" [rowHover]="true" dataKey="id"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} entradas" [showCurrentPageReport]="true"
        styleClass="p-datatable-responsive-demo">
        <ng-template pTemplate="caption">
            <div class="p-d-flex p-ai-center p-jc-between">
                <h3 class="p-m-0">Evaluaciones</h3>
                <span class="p-input-icon-left">
                    <i class="pi pi-search"></i>
                    <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')" placeholder="Buscar..." />
                </span>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="title">
                    Título <p-sortIcon field="title"></p-sortIcon>
                </th>
                <th pSortableColumn="profile">
                    Perfiles <p-sortIcon field="profile"></p-sortIcon>
                </th>
                <th pSortableColumn="questionNumber">
                    No Preguntas <p-sortIcon field="questionNumber"></p-sortIcon>
                </th>
                <th pSortableColumn="createdAt">
                    Fecha de creación <p-sortIcon field="createdAt"></p-sortIcon>
                </th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
            <tr>
                <td>
                    <span class="p-column-title">Título:</span>
                    {{ item.name }}
                </td>

                <td>
                    <span class="p-column-title">Perfiles:</span>
                    <ul>
                        <li *ngFor="let item of item.profiles">
                            {{item.name}}
                        </li>
                    </ul>
                </td>
                <td>
                    <span class="p-column-title">No Preguntas:</span>
                    <div>{{item.questions?.length || 0}}</div>
                </td>
                <td>
                    <span class="p-column-title">Creado:</span>
                    {{item.createdAt | date: 'yyyy/MM/dd' }}
                </td>

                <td>
                    <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success p-mr-2"
                        (click)="editItem(item)"></button>
                    <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning p-mr-2"
                        (click)="deleteItem(item)"></button>
                    <button pButton pRipple icon="pi pi-question" class="p-button-rounded p-button-rounded"
                        [routerLink]="['/admin/evaluations/list-question/', item.id]"></button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="summary">
            <div class="p-d-flex p-ai-center p-jc-between">
                En total existen {{ items ? items.length : 0 }} evaluaciones
            </div>
        </ng-template>
    </p-table> 
</div>

<!-- Modal Evaluation -->
<p-dialog [(visible)]="itemDialog" [style]="{ width: '450px' }" header="Detalle de evaluaciones" [modal]="true"
    styleClass="p-fluid" (onHide)="onHideCreate($event)" [draggable]="false">
    <ng-template pTemplate="content">

        <form [formGroup]="checkEvaluationForm" novalidate>
            <div class="p-field">
                <label for="code">Evaluaciones disponibles:*</label>
                <p-dropdown inputId="code" [options]="evaluationsAvailables" placeholder="Seleccione una evaluación"
                    formControlName="id" optionValue="code" (onChange)="onSelectEvaluationType()">
                    <ng-template let-option pTemplate="item">
                        <span>{{option.label}}</span>
                    </ng-template>
                </p-dropdown>
                <div
                    *ngIf="checkEvaluationForm.get('code')?.invalid && (checkEvaluationForm.get('code')?.dirty || checkEvaluationForm.get('code')?.touched)">
                    <div *ngIf="checkEvaluationForm.get('code')?.errors?.required">
                        <small class="p-error">{{'t.validateRequiredField' | translate}}</small>
                    </div>
                </div>
            </div>

            <div class="p-field">
                <label for="type">Tipo:*</label>
                <p-dropdown inputId="type" [options]="evaluationsTypes" placeholder="Seleccione..."
                    formControlName="type" optionValue="code">
                    <ng-template let-option pTemplate="item">
                        <span>{{option.label}}</span>
                    </ng-template>
                </p-dropdown>
                <div
                    *ngIf="checkEvaluationForm.get('code')?.invalid && (checkEvaluationForm.get('code')?.dirty || checkEvaluationForm.get('code')?.touched)">
                    <div *ngIf="checkEvaluationForm.get('code')?.errors?.required">
                        <small class="p-error">{{'t.validateRequiredField' | translate}}</small>
                    </div>
                </div>
            </div>

            <!-- Titulo Evaluacion -->
            <!-- <div class="p-field">
                <label for="name">{{'t.titleEvaluation' | translate}}:*</label>
                <input type="text" pInputText id="name" formControlName="name" required
                    placeholder="{{'t.titleEvaluation' | translate}}" />
            </div> -->

            <!-- Perfiles -->
            <div class="p-field">
                <label for="idProfile">{{'t.titleProfile' | translate}}:*</label>
                <p-multiSelect [options]="profileItems" formControlName="idProfiles" optionLabel="name"
                    optionValue="id">
                </p-multiSelect>
            </div>

            <!-- Descripcion -->
            <div class="p-field">
                <label for="description">{{'t.titleDescription' | translate}}:*</label>
                <textarea formControlName="description" rows="5" cols="30" pInputTextarea></textarea>
            </div>

            <!-- Puntaje recomendado -->
            <div class="p-field">
                <label for="minScorePercent">{{'t.titleScore' | translate}}:*</label>
                <input type="text" pInputText id="minScorePercent" formControlName="minScorePercent" required
                    placeholder="/100" />
            </div>

        </form>
    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
        <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="saveItem()"></button>
    </ng-template>

</p-dialog>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>